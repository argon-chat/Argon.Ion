#feature "orleans"


flags ArgonEntitlement: u8 {
    None = 0,

    ViewChannel = 1 << 0,
    ReadHistory = 1 << 1,
    JoinToVoice = 1 << 2,

    SendMessages      = 1 << 5,
    SendVoice         = 1 << 6,
    AttachFiles       = 1 << 7,
    AddReactions      = 1 << 8,
    AnyMentions       = 1 << 9,
    MentionEveryone   = 1 << 10,
    ExternalEmoji     = 1 << 11,
    ExternalStickers  = 1 << 12,
    UseCommands       = 1 << 13,
    PostEmbeddedLinks = 1 << 14,

    Connect = 1 << 20,
    Speak   = 1 << 21,
    Video   = 1 << 22,
    Stream  = 1 << 23,

    UseASIO           = 1 << 30,
    AdditionalStreams = 1 << 31,

    DisconnectMember = 1 << 40,
    MoveMember       = 1 << 41,
    BanMember        = 1 << 42,
    MuteMember       = 1 << 43,
    KickMember       = 1 << 44,

    ManageChannels  = 1 << 50,
    ManageArchetype = 1 << 51,
    ManageBots      = 1 << 52,
    ManageEvents    = 1 << 53,
    ManageBehaviour = 1 << 54,
    ManageServer    = 1 << 55
}

service ServerInteraction(spaceId: guid)
{
    GetMembers(): RealtimeServerMember[];
    GetMember(userId: guid): RealtimeServerMember;


    GetInviteCodes(): InviteCodeEntity[];
    CreateInviteCode(): InviteCode;

    PrefetchUser(userId: guid): ArgonUser;
    PrefetchProfile(userId: guid): ArgonUserProfile;

    GetChannels(): RealtimeChannel[];

    GetServerArchetypes(): Archetype[];
    GetDetailedServerArchetypes(): ArchetypeGroup[];

    BeginUploadSpaceProfileHeader(): guid;
    CompleteUploadSpaceProfileHeader(blobId: guid);

    BeginUploadSpaceAvatar(): guid;
    CompleteUploadSpaceAvatar(blobId: guid);
}

msg ArgonSpaceBase {
    spaceId: guid;
    name: string;
    description: string;
    avatarFieldId: string?;
    topBannerFileId: string?;
}

msg ArgonSpace {
    spaceId: guid;
    name: string;
    description: string;
    avatarFieldId: string?;
    topBannerFileId: string?;
    channels: ArgonChannel[];
    members: SpaceMember[];
    archetypes: Archetype[];
}

msg ArchetypeGroup {
    archetype: Archetype;
    members: guid[];
}

msg SpaceMemberArchetype {
    serverMemberId: guid;
    archetypeId: guid;
}

msg SpaceMember {
    userId: guid;
    spaceId: guid;
    joinedAt: datetime;
    memberId: guid;
    user: ArgonUser;
    archetypes: SpaceMemberArchetype[];
}

msg RealtimeServerMember
{
    member: SpaceMember;
    status: UserStatus;
    presence: UserActivityPresence?;
}

msg InviteCodeEntity {
    code: InviteCode;
    spaceId: guid;
    issuerId: guid;
    expireTime: datetime;
    used: u8;
}

msg InviteCode {
    inviteCode: string;
}


msg ArgonUser {
    userId: guid;
    username: string;
    displayName: string;
    avatarFileId: string?;
}

msg ArgonUserProfile {
    userId: guid;
    customStatus: string?;
    customStatusIconId: string?;
    bannerFileID: string?;
    dateOfBirth: dateonly?;
    bio: string?;
    isPremium: bool;
    badges: string[];
    archetypes: SpaceMemberArchetype[];
}

enum UserStatus
{
    Offline,
    Online,
    Away,
    InGame,
    Listen,
    TouchGrass,
    DoNotDisturb
}